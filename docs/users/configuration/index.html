<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Configuration - Docs - Theatersoft</title>
    <meta name="author" content="Theatersoft">
    <meta name="description" content="Theatersoft">
    <meta name="viewport" content="width=device-width"/>
    <link rel="manifest" href="assets/manifest.json">
    <link rel="icon" type="image/png" href="/assets/theatersoft-logo-round-accent-48.png"/>
    <link rel="stylesheet" href="/theatersoft.css">
    <script defer src="/theatersoft.js"></script>
    <script>
        window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
        ga('create', 'UA-105697373-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Organization",
        "url": "http://www.theatersoft.com",
        "name": "Theatersoft",
        "logo": "http://www.theatersoft.com/assets/theatersoft-logo-round-accent.png"
    }
    </script>
</head>
<body>
<svg display="none"><symbol id="svg-logo" viewBox="0 0 280 240"><path d="m132.7 21.94-100.5 58.06c-4.385 2.536-7.077 7.161-7.076 12.16v3.018 109.8c-.0029 7.791 6.424 14.11 14.36 14.11h64.73c7.932-.008 14.36-6.322 14.36-14.11v-25.11c10.5-5.275 17.85-15.91 17.85-28.16 0-17.37-14.63-31.75-32.31-31.75-17.68.00001-32.31 14.38-32.31 31.75 0 12.33 7.44 23.02 18.04 28.26v10.91h-35.99v-90.67l86.17-49.78 86.16 49.78v91.36l-35.8-.5008v-11.2c10.5-5.275 17.85-15.91 17.85-28.16 0-17.37-14.63-31.75-32.31-31.75s-32.31 14.38-32.31 31.75c0 12.33 7.44 23.02 18.04 28.26v25.01c-.005 7.718 6.307 14.01 14.16 14.11l64.51.8766c8.012.1153 14.57-6.231 14.57-14.1v-113.7c.00083-4.998-2.691-9.624-7.076-12.16l-100.6-58.1c-2.077-1.195-4.427-1.858-6.834-1.929-2.709-.0862-5.388.5824-7.726 1.929z"></path></symbol><symbol id="svg-github" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></symbol><symbol id="svg-list" viewBox="0 0 32 32"><path d="M25.6 14.4h-19.2c-0.883 0-1.6 0.717-1.6 1.6s0.717 1.6 1.6 1.6h19.2c0.885 0 1.6-0.717 1.6-1.6s-0.715-1.6-1.6-1.6zM6.4 11.2h19.2c0.885 0 1.6-0.717 1.6-1.6s-0.715-1.6-1.6-1.6h-19.2c-0.883 0-1.6 0.717-1.6 1.6s0.717 1.6 1.6 1.6zM25.6 20.8h-19.2c-0.883 0-1.6 0.715-1.6 1.6s0.717 1.6 1.6 1.6h19.2c0.885 0 1.6-0.715 1.6-1.6s-0.715-1.6-1.6-1.6z"></path></symbol><symbol id="svg-x" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></symbol></svg>
<nav><a href="/"><svg><use href="#svg-logo"></use></svg><span>Theatersoft</span></a><ul id="_566"><a href="/docs/" class="_40d">Docs</a><a href="/install/" class>Install</a><a href="https://community.theatersoft.com/" onclick="trackLink(event)" class>Community</a><a target="_blank" href="https://github.com/theatersoft"><svg><use href="#svg-github"></use></svg></a></ul><div id="_c62"><svg><use href="#svg-list"></use></svg></div></nav>
<header class="_593"></header>
<main class="_485"><article><div class="markdown"><h2 id="configuration">Configuration</h2>
<p>Once you understand how the Theatersoft platform configuration works you’ll realize its full customization potential.</p>
<p>In essence, a <code>config.json</code> file describes the configuration state for the installation. It consists of general configuration options, the <code>hosts</code> list of one or more Theatersoft servers in your site, and a <code>services</code> list of service configurations for each server. Each service configuration contains a <code>module</code> name for the corresponding <code>npm</code> package name and a <code>config</code> object for custom service options.</p>
<p>Administration scripts automate the process of converting the configuration into a deployed server installation(s). The <code>config</code> script stages a generated <code>package.json</code> file for each server containing that servers service module dependencies. The <code>deploy</code> script copies the generated packages to each server and performs the <code>npm install</code> package installation. </p>
<p>At runtime, the root server loads <code>config.json</code> and creates a <code>Config</code> bus service with APIs that makes the service configuration available to each server to use to start their services.</p>
<h3 id="initial-configuration">Initial Configuration</h3>
<p>The <code>@theatersoft/home</code> package automates installation and configuration. It was installed and used during <a href="/install/">installation</a>:</p>
<pre><code class="language-bash"><span class="token function">cd</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> example <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> example <span class="token comment" spellcheck="true"># replace example with your site/domain name</span>
<span class="token function">npm</span> <span class="token function">install</span> @theatersoft/home
<span class="token function">npm</span> explore @theatersoft/home <span class="token function">npm</span> run config deploy
</code></pre>
<p>When you run <code>npm run config deploy</code> for the first time, it populates your site directory <code>~/example</code>:</p>
<pre><code class="language-bash"> <span class="token keyword">.</span>
 ├── config.json
 ├── deploy
 ├── .gitignore
 ├── node_modules
 ├── package.json
 └── package-lock.json
</code></pre>
<p>Your site configuration file <code>config.json</code> was generated from a template. You can modify it with any text editor. Always use valid JSON syntax, even if documentation refers to properties as JavaScript objects (e.g. <code>config.hosts</code>).</p>
<pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"_letsencrypt"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"domain"</span><span class="token operator">:</span> <span class="token string">"example.com"</span><span class="token punctuation">,</span>
    <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"email@example.com"</span><span class="token punctuation">,</span>
    <span class="token property">"production"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">"0000"</span><span class="token punctuation">,</span>
  <span class="token property">"hosts"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"raspberrypi"</span><span class="token punctuation">,</span>
      <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"raspberrypi.local"</span><span class="token punctuation">,</span>
      <span class="token property">"mac"</span><span class="token operator">:</span> <span class="token string">"00:00:00:00:00:0"</span><span class="token punctuation">,</span>
      <span class="token property">"services"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"@theatersoft/device"</span><span class="token punctuation">,</span>
          <span class="token property">"export"</span><span class="token operator">:</span> <span class="token string">"Device"</span><span class="token punctuation">,</span>
          <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Device"</span><span class="token punctuation">,</span>
          <span class="token property">"config"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"configs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>package.json</code> contains administration scripts for config and deploy:</p>
<pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Theatersoft Home site installation"</span><span class="token punctuation">,</span>
  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"config"</span><span class="token operator">:</span> <span class="token string">"npm explore @theatersoft/home -- npm run config"</span><span class="token punctuation">,</span>
    <span class="token property">"deploy"</span><span class="token operator">:</span> <span class="token string">"npm explore @theatersoft/home -- npm run deploy"</span><span class="token punctuation">,</span>
    <span class="token property">"deploy-raspberrypi"</span><span class="token operator">:</span> <span class="token string">"npm run deploy -- -- -- raspberrypi"</span><span class="token punctuation">,</span>
    <span class="token property">"journal-raspberrypi"</span><span class="token operator">:</span> <span class="token string">"journalctl -u theatersoft -f --no-tail"</span><span class="token punctuation">,</span>
    <span class="token property">"restart-raspberrypi"</span><span class="token operator">:</span> <span class="token string">"systemctl restart theatersoft"</span><span class="token punctuation">,</span>
    <span class="token property">"stop-office"</span><span class="token operator">:</span> <span class="token string">"systemctl stop theatersoft"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@theatersoft/home"</span><span class="token operator">:</span> <span class="token string">"~2"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"theatersoft"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"pack"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">443</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"example"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The deployment files for each host are staged in <code>deploy</code>:</p>
<pre><code class="language-bash">deploy/
└── raspberrypi
    ├── .bus
    ├── package.json
    ├── .root
    └── theatersoft.service
</code></pre>
<h3 id="adding-services">Adding Services</h3>
<p>Available services are listed in <a href="/docs/services/">Services</a>.  Check the documentation first to find any specific installation instructions such as hardware requirements.</p>
<p>There are two basic steps to add a service:</p>
<ol>
<li><p>Copy the sample configuration object and paste it into <code>config.json</code> by adding it to a <code>host.services[]</code> array, making any customizations as instructed.</p>
</li>
<li><p>Rerun <code>npm run config deploy</code></p>
</li>
</ol>
<h3 id="adding-servers">Adding Servers</h3>
<p>You can also add additional servers. For example, you may need to connect device controllers or video capture cards to machines in separate locations.</p>
<p>The steps to add a server are similar to adding individual services:</p>
<ol>
<li><p>Edit <code>config.json</code> and add a new entry to the <code>host[]</code> array, using an existing host as a template and setting <code>name</code>, <code>host</code>, and <code>services</code> as needed.</p>
</li>
<li><p>Rerun <code>npm run config deploy</code> (This requires passwordless login to the host using <code>ssh</code> key authentication.)</p>
</li>
</ol>
</div></article></main>
<footer><div><span>© 2018 Theatersoft, LLC</span></div></footer>
</body>
</html>