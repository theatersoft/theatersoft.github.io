<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Install - Theatersoft</title>
    <meta name="author" content="Theatersoft">
    <meta name="description" content="Theatersoft">
    <meta name="viewport" content="width=device-width"/>
    <link rel="manifest" href="assets/manifest.json">
    <link rel="icon" type="image/png" href="/assets/theatersoft-logo-round-accent-48.png"/>
    <link rel="stylesheet" href="/theatersoft.css">
    <script defer src="/theatersoft.js"></script>
    <script>
        window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
        ga('create', 'UA-105697373-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Organization",
        "url": "http://www.theatersoft.com",
        "name": "Theatersoft",
        "logo": "http://www.theatersoft.com/assets/theatersoft-logo-round-accent.png"
    }
    </script>
</head>
<body>
<svg display="none"><symbol id="svg-logo" viewBox="0 0 280 240"><path d="m132.7 21.94-100.5 58.06c-4.385 2.536-7.077 7.161-7.076 12.16v3.018 109.8c-.0029 7.791 6.424 14.11 14.36 14.11h64.73c7.932-.008 14.36-6.322 14.36-14.11v-25.11c10.5-5.275 17.85-15.91 17.85-28.16 0-17.37-14.63-31.75-32.31-31.75-17.68.00001-32.31 14.38-32.31 31.75 0 12.33 7.44 23.02 18.04 28.26v10.91h-35.99v-90.67l86.17-49.78 86.16 49.78v91.36l-35.8-.5008v-11.2c10.5-5.275 17.85-15.91 17.85-28.16 0-17.37-14.63-31.75-32.31-31.75s-32.31 14.38-32.31 31.75c0 12.33 7.44 23.02 18.04 28.26v25.01c-.005 7.718 6.307 14.01 14.16 14.11l64.51.8766c8.012.1153 14.57-6.231 14.57-14.1v-113.7c.00083-4.998-2.691-9.624-7.076-12.16l-100.6-58.1c-2.077-1.195-4.427-1.858-6.834-1.929-2.709-.0862-5.388.5824-7.726 1.929z"></path></symbol><symbol id="svg-github" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></symbol><symbol id="svg-list" viewBox="0 0 32 32"><path d="M25.6 14.4h-19.2c-0.883 0-1.6 0.717-1.6 1.6s0.717 1.6 1.6 1.6h19.2c0.885 0 1.6-0.717 1.6-1.6s-0.715-1.6-1.6-1.6zM6.4 11.2h19.2c0.885 0 1.6-0.717 1.6-1.6s-0.715-1.6-1.6-1.6h-19.2c-0.883 0-1.6 0.717-1.6 1.6s0.717 1.6 1.6 1.6zM25.6 20.8h-19.2c-0.883 0-1.6 0.715-1.6 1.6s0.717 1.6 1.6 1.6h19.2c0.885 0 1.6-0.715 1.6-1.6s-0.715-1.6-1.6-1.6z"></path></symbol><symbol id="svg-x" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></symbol></svg>
<nav><a href="/"><svg><use href="#svg-logo"></use></svg><span>Theatersoft</span></a><ul id="_566"><a href="/docs/" class>Docs</a><a href="/install/" class="_40d">Install</a><a href="https://community.theatersoft.com/" onclick="trackLink(event)" class>Community</a><a target="_blank" href="https://github.com/theatersoft"><svg><use href="#svg-github"></use></svg></a></ul><div id="_c62"><svg><use href="#svg-list"></use></svg></div></nav>
<header><div class="_e76"></div><div class="_720"></div><div class="_e95"><h1>Install Theatersoft Home on a Raspberry Pi 3</h1></div></header>
<main class="_485"><article><div class="markdown"><p>Ready to get started with Theatersoft Home?  Follow these steps to install on a Raspberry Pi 3 and then add the Z-Wave USB controller to control Z-Wave devices.</p>
<p class="page-image"><img src="/images/install-rpi3/rpi3.jpg" alt="Install Theatersoft Home on a Raspberry Pi 3"></p>

<h2 id="checklist">Checklist</h2>
<blockquote>
<ul>
<li>Raspberry Pi 3 Model B</li>
<li>microSD card</li>
<li>5V 2A power supply</li>
<li>wired ethernet network (for WiFi, see <a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md">here</a>)</li>
<li>a USB Z-Wave controller (SIGMA ACC-UZB3-U-STA or Aeotec Z-Stick Gen5 for the 908Mhz US frequency)</li>
<li>a computer to prepare the boot microSD card and connect to the Pi</li>
</ul>
</blockquote>
<p>You should also have a domain name for the Theatersoft Client web app. We’ll use it to set up dynamic DNS updates and to create an SSL certificate for the server.</p>
<h2 id="install-steps">Install steps</h2>
<h3 id="1-prepare-the-boot-microsd">1. Prepare the boot microSD</h3>
<p>Download the latest <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspian Stretch Lite</a> image and prepare the microSD using the <a href="https://www.raspberrypi.org/documentation/installation/installing-images/README.md">installation guide</a>. In particular, make sure SSH is enabled.</p>
<h3 id="2-boot-and-connect-to-the-pi">2. Boot and connect to the Pi</h3>
<p>Insert the boot microSD into the Pi and connect network and power. Connect with SSH to the Pi: <code>ssh pi@raspberrypi.local</code> (password: raspberry). Read <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/README.md">remote access</a> for help with SSH.</p>
<h3 id="3-install-node-js">3. Install Node.js</h3>
<p>Run the following on the Pi :</p>
<pre><code>curl -sL https://deb.nodesource.com/setup_8.x <span class="token operator">|</span> <span class="token function">sudo</span> -E <span class="token function">bash</span> -
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y nodejs
</code></pre><h3 id="4-install-theatersoft-home">4. Install Theatersoft Home</h3>
<p>Create a directory to store your Theatersoft site configuration. Then install, configure, and deploy <code>@theatersoft/home</code>:</p>
<pre><code><span class="token function">cd</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> example <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> example   <span class="token comment" spellcheck="true"># replace example with your site/domain name</span>
<span class="token function">npm</span> <span class="token function">install</span> @theatersoft/home
<span class="token function">npm</span> explore @theatersoft/home <span class="token function">npm</span> run config deploy
</code></pre><p>The Theatersoft server is now running.  The next step will enable you to access it from outside your home network.</p>
<h3 id="5-configure-dynamic-dns-and-server-ssl-certificate">5. Configure dynamic DNS and server SSL certificate</h3>
<blockquote>
<p>RECOMMENDED FOR TESTING ONLY</p>
<p>If you want to create a self-signed certificate:</p>
<pre><code><span class="token function">cd</span> /opt/theatersoft/.config/theatersoft
openssl req -x509 -newkey rsa:4096 -keyout server.key -out server.cer -days 365 -nodes
</code></pre><p>Accept the defaults when prompted. Skip to <em>Restart the Theatersoft server</em>.</p>
</blockquote>
<p>Install ddclient:</p>
<pre><code><span class="token function">sudo</span> apt <span class="token function">install</span> ddclient
</code></pre><p>For a domain registered at <code>namecheap.com</code>, refer to <a href="https://www.namecheap.com/support/knowledgebase/article.aspx/583/11/how-do-i-configure-ddclient">How do I configure DDClient?</a> to answer the installation prompts and edit the configuration in <code>/etc/ddclient.conf</code>. Otherwise, find a similar guide for your registrar.</p>
<pre><code><span class="token comment" spellcheck="true"># Configuration file for ddclient generated by debconf</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># /etc/ddclient.conf</span>

use<span class="token operator">=</span>web, web<span class="token operator">=</span>dynamicdns.park-your-domain.com/getip
protocol<span class="token operator">=</span>namecheap
server<span class="token operator">=</span>dynamicdns.park-your-domain.com
login<span class="token operator">=</span>example.com
password<span class="token operator">=</span><span class="token operator">&lt;</span>not shown<span class="token operator">></span>
home
</code></pre><p>This will automatically update the nameserver for <code>home.example.com</code>. We can see if it worked by checking the end of the system log: <code>journalctl -e</code>:</p>
<pre><code>Sep 14 20:48:01 raspberrypi ddclient<span class="token punctuation">[</span>26501<span class="token punctuation">]</span>: SUCCESS:  updating home: good: IP address <span class="token keyword">set</span> to 50.35.xx.xx
</code></pre><p>Forward port 443 from the internet to your Pi’s internal network address in your network router’s configuration. This process will vary depending on your router.</p>
<p>You’re ready to enable letsencypt in <code>config.json</code>. Remove the underscore from  the <code>_letsencrypt</code> property name and provide your values for <code>domain</code> and <code>email</code>.</p>
<pre><code class="language-javascript">  <span class="token string">"letsencrypt"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"domain"</span><span class="token punctuation">:</span> <span class="token string">"home.example.com"</span><span class="token punctuation">,</span>
    <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"name@example.com"</span><span class="token punctuation">,</span>
    <span class="token string">"production"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
<p>Restart the Theatersoft server: <code>sudo systemctl restart theatersoft</code>.</p>
<h3 id="6-pair-theatersoft-client">6. Pair Theatersoft Client</h3>
<p>Open the Theatersoft Client app in your browser, e.g. <code>https://home.example.com</code> (or <code>https://raspberrypi.local</code> if testing without a domain name).</p>
<p class="page-image"><img src="/images/install-rpi3/pinpad.png" alt="Theatersoft Pinpad"></p>

<p>This is the pinpad login screen, which appears when your browser doesn’t have a valid session cookie. Click the lock icon to pair with the default password <code>0000</code>. (You can change the password in <code>config.json</code>.) You are now connected and see a default black background since you have no camera feeds configured.</p>
<p>Click (or tap - the client is fully touch enabled) near the center of the page to activate the tapmenu. This is the launching point for the Theatersoft UI. Since the tapmenu is sensitive to the relative position of two taps it’s easy to use without even looking at the screen. Try tapping as fast as your device can handle!</p>
<p class="page-image"><img src="/images/install-rpi3/tapmenu.png" alt="Theatersoft Tapmenu"></p>

<p>Before continuing, open the top status screen. Turn off the <code>Enable pairing</code> switch. Pairing should normally be disabled to block brute force attacks. Turn on <code>Enable notifications</code> to receive web push notifications including failed pairing attempts and new paired connections.</p>
<h3 id="7-install-zwave">7. Install ZWave</h3>
<p>Build the OpenZWave project, which is a dependency of the ZWave service:</p>
<pre><code><span class="token function">cd</span> ~/
<span class="token function">wget</span> https://github.com/OpenZWave/open-zwave/archive/v1.4.zip
unzip v1.4.zip 
<span class="token function">cd</span> open-zwave-1.4
<span class="token function">sudo</span> apt <span class="token function">install</span> libudev-dev git-core
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
<span class="token function">sudo</span> <span class="token function">mv</span> /usr/local/lib/libopenzwave.so* /usr/lib/arm-linux-gnueabihf/
</code></pre><p>Add the ZWave service with <code>nano ~/example/config.json</code>. Insert the following object after the existing Device service:</p>
<pre><code class="language-javascript">        <span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">"enabled"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">"module"</span><span class="token punctuation">:</span> <span class="token string">"@theatersoft/zwave"</span><span class="token punctuation">,</span>
          <span class="token string">"export"</span><span class="token punctuation">:</span> <span class="token string">"ZWave"</span><span class="token punctuation">,</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"ZWave"</span><span class="token punctuation">,</span>
          <span class="token string">"config"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">"port"</span><span class="token punctuation">:</span> <span class="token string">"/dev/ttyACM0"</span><span class="token punctuation">,</span>
            <span class="token string">"options"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
              <span class="token string">"Logging"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token string">"ConsoleOutput"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token string">"SaveLogLevel"</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre>
<p>Then reconfigure and redeploy. This performs all installation and restarts the server.</p>
<pre><code><span class="token function">npm</span> run config deploy
</code></pre><p>The ZWave service is now started and the client shows ZWave in the Services Settings (tap, left tap, Services):</p>
<p class="page-image"><img src="/images/install-rpi3/settings.png" alt="Theatersoft Service Settings"></p>

<h3 id="8-test-a-zwave-device">8. Test a ZWave device</h3>
<p>Open ZWave service settings and turn on Add Device:</p>
<p class="page-image"><img src="/images/install-rpi3/zwave-settings.png" alt="Theatersoft ZWave Service Settings"></p>

<p>The controller is now in <em>inclusion</em> mode, ready to add new Z-Wave devices. Check your device to learn how to trigger include/exclude. The Zooz chime device that I’ve added required a triple press of the button inside the battery compartment. Look for the new switch in the devices list (tap, right tap, Switch).</p>
<p class="page-image"><img src="/images/install-rpi3/zwave-switch.png" alt="Theatersoft ZWave Switch"></p>

<p>For general device settings and ZWave device settings tap elsewhere on the list item. The name setting is currently readonly in the UI but you can override it in <code>/opt/theatersoft/.config/theatersoft/zwave.config.json</code>.</p>
<p class="page-image"><img src="/images/install-rpi3/device-settings.png" alt="Theatersoft ZWave Device Settings"></p>

<h2 id="next-steps">Next steps</h2>
<p>Learn more and join the <a href="https://community.theatersoft.com/">Theatersoft Community</a>.</p>
</div></article></main>
<footer><div><span>© 2018 Theatersoft, LLC</span></div></footer>
</body>
</html>